<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>💘 Test de Fuerza Relacional</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap");

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Rajdhani", sans-serif;
        background: #0a0a0a;
        background-image: radial-gradient(
            circle at 20% 80%,
            rgba(120, 119, 198, 0.3) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 20%,
            rgba(255, 119, 198, 0.3) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 40% 40%,
            rgba(120, 219, 226, 0.2) 0%,
            transparent 50%
          );
        min-height: 100vh;
        color: #ffffff;
        overflow-x: hidden;
        position: relative;
      }

      .cyber-grid {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: linear-gradient(
            rgba(0, 255, 255, 0.03) 1px,
            transparent 1px
          ),
          linear-gradient(90deg, rgba(0, 255, 255, 0.03) 1px, transparent 1px);
        background-size: 50px 50px;
        pointer-events: none;
        z-index: 1;
      }

      .floating-hearts {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 2;
      }

      .heart-3d {
        position: absolute;
        width: 40px;
        height: 36px;
        opacity: 0.7;
        animation: floatHeart3D 15s infinite linear;
        filter: drop-shadow(0 0 8px currentColor);
      }

      .heart-3d::before,
      .heart-3d::after {
        content: "";
        position: absolute;
        width: 20px;
        height: 32px;
        border-radius: 20px 20px 0 0;
        transform: rotate(-45deg);
        transform-origin: 0 100%;
        background: linear-gradient(
          135deg,
          #ff1493 0%,
          #ff69b4 50%,
          #ff1493 100%
        );
        box-shadow: inset -2px -2px 8px rgba(139, 0, 90, 0.7),
          inset 2px 2px 8px rgba(255, 105, 180, 0.7),
          0 0 15px rgba(255, 20, 147, 0.5);
      }

      .heart-3d::before {
        left: 20px;
      }

      .heart-3d::after {
        left: 0;
        transform: rotate(45deg);
        transform-origin: 100% 100%;
      }

      .heart-3d.cyan::before,
      .heart-3d.cyan::after {
        background: linear-gradient(
          135deg,
          #00ffff 0%,
          #40e0d0 50%,
          #00ffff 100%
        );
        box-shadow: inset -2px -2px 8px rgba(0, 128, 128, 0.7),
          inset 2px 2px 8px rgba(64, 224, 208, 0.7),
          0 0 15px rgba(0, 255, 255, 0.5);
      }

      .heart-3d.purple::before,
      .heart-3d.purple::after {
        background: linear-gradient(
          135deg,
          #9932cc 0%,
          #ba55d3 50%,
          #9932cc 100%
        );
        box-shadow: inset -2px -2px 8px rgba(72, 25, 99, 0.7),
          inset 2px 2px 8px rgba(186, 85, 211, 0.7),
          0 0 15px rgba(153, 50, 204, 0.5);
      }

      .heart-3d.orange::before,
      .heart-3d.orange::after {
        background: linear-gradient(
          135deg,
          #ff6b35 0%,
          #ff8c42 50%,
          #ff6b35 100%
        );
        box-shadow: inset -2px -2px 8px rgba(204, 54, 27, 0.7),
          inset 2px 2px 8px rgba(255, 140, 66, 0.7),
          0 0 15px rgba(255, 107, 53, 0.5);
      }

      @keyframes floatHeart3D {
        0% {
          transform: translateY(100vh) translateX(0) rotate(0deg) scale(0.8);
          opacity: 0;
        }
        10% {
          opacity: 0.7;
        }
        50% {
          transform: translateY(50vh) translateX(20px) rotate(180deg) scale(1.2);
          opacity: 0.8;
        }
        90% {
          opacity: 0.7;
        }
        100% {
          transform: translateY(-10vh) translateX(-20px) rotate(360deg)
            scale(0.8);
          opacity: 0;
        }
      }

      .neon-particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 3;
      }

      .particle {
        position: absolute;
        width: 3px;
        height: 3px;
        background: #00ffff;
        border-radius: 50%;
        box-shadow: 0 0 8px #00ffff;
        animation: particleFloat 8s infinite ease-in-out;
      }

      @keyframes particleFloat {
        0%,
        100% {
          transform: translateY(0) translateX(0);
          opacity: 0.3;
        }
        50% {
          transform: translateY(-25px) translateX(25px);
          opacity: 1;
        }
      }

      .container {
        max-width: 100%;
        margin: 0 auto;
        padding: 10px;
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        z-index: 10;
      }

      .screen {
        background: rgba(5, 5, 5, 0.95);
        backdrop-filter: blur(25px);
        border-radius: 20px;
        padding: 20px;
        width: 100%;
        max-width: 500px;
        box-shadow: 0 0 40px rgba(0, 255, 255, 0.2),
          inset 0 0 40px rgba(255, 20, 147, 0.1), 0 8px 32px rgba(0, 0, 0, 0.8);
        border: 2px solid transparent;
        background-clip: padding-box;
        position: relative;
        transform: translateY(20px) scale(0.95);
        opacity: 0;
        animation: screenGlow 0.8s ease forwards;
        display: none;
      }

      .screen::before {
        content: "";
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, #00ffff, #ff1493, #9932cc, #00ffff);
        border-radius: 20px;
        z-index: -1;
        animation: borderGlow 3s ease infinite;
      }

      @keyframes borderGlow {
        0%,
        100% {
          opacity: 0.6;
        }
        50% {
          opacity: 1;
        }
      }

      .screen.active {
        display: block;
      }

      @keyframes screenGlow {
        to {
          transform: translateY(0) scale(1);
          opacity: 1;
        }
      }

      h1 {
        text-align: center;
        font-family: "Orbitron", monospace;
        background: linear-gradient(45deg, #00ffff, #ff1493, #9932cc);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 15px;
        font-size: 1.8rem;
        font-weight: 900;
        text-transform: uppercase;
        letter-spacing: 2px;
        animation: titlePulse 2s ease-in-out infinite;
        text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        line-height: 1.2;
      }

      @keyframes titlePulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.02);
        }
      }

      h2 {
        text-align: center;
        color: #ffffff;
        background: rgba(0, 0, 0, 0.8);
        padding: 12px 20px;
        border-radius: 12px;
        margin-bottom: 20px;
        font-size: 1.3rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1px;
        animation: fadeInUp 1s ease 0.3s both;
        text-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
        border: 1px solid rgba(0, 255, 255, 0.3);
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .subtitle {
        text-align: center;
        color: #ffffff;
        background: rgba(0, 0, 0, 0.8);
        padding: 15px;
        border-radius: 12px;
        margin-bottom: 20px;
        font-size: 1rem;
        line-height: 1.5;
        animation: fadeInUp 1s ease 0.5s both;
        font-weight: 500;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .role-selector {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin: 25px 0;
      }

      .role-btn {
        padding: 20px 15px;
        border: 2px solid #333;
        border-radius: 15px;
        background: rgba(0, 0, 0, 0.9);
        cursor: pointer;
        transition: all 0.4s ease;
        text-align: center;
        font-size: 1rem;
        font-weight: 700;
        position: relative;
        overflow: hidden;
        color: #ffffff;
        text-transform: uppercase;
        letter-spacing: 1px;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
      }

      .role-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(0, 255, 255, 0.2),
          transparent
        );
        transition: left 0.6s;
      }

      .role-btn:hover {
        transform: scale(1.05);
        border-color: #00ffff;
        box-shadow: 0 0 20px rgba(0, 255, 255, 0.4),
          inset 0 0 20px rgba(0, 255, 255, 0.1);
      }

      .role-btn:hover::before {
        left: 100%;
      }

      .role-btn.selected {
        background: rgba(0, 0, 0, 0.95);
        border-color: #ff1493;
        box-shadow: 0 0 30px rgba(255, 20, 147, 0.5),
          inset 0 0 20px rgba(255, 20, 147, 0.2);
        animation: selectedGlow 0.6s ease;
      }

      @keyframes selectedGlow {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.08);
        }
        100% {
          transform: scale(1.05);
        }
      }

      .role-icon {
        font-size: 2.5rem;
        margin-bottom: 10px;
        display: block;
        filter: drop-shadow(0 0 8px currentColor);
      }

      .btn {
        width: 100%;
        padding: 15px 30px;
        border: none;
        border-radius: 15px;
        background: linear-gradient(135deg, #ff1493, #00ffff, #9932cc);
        background-size: 200% 200%;
        color: #ffffff;
        font-size: 1.1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.4s ease;
        margin-top: 20px;
        position: relative;
        overflow: hidden;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-family: "Orbitron", monospace;
        animation: buttonPulse 2s ease infinite;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
      }

      @keyframes buttonPulse {
        0%,
        100% {
          background-position: 0% 50%;
          box-shadow: 0 0 15px rgba(255, 20, 147, 0.4);
        }
        50% {
          background-position: 100% 50%;
          box-shadow: 0 0 25px rgba(0, 255, 255, 0.6);
        }
      }

      .btn:hover {
        transform: translateY(-2px) scale(1.02);
        box-shadow: 0 8px 20px rgba(255, 20, 147, 0.5);
      }

      .btn:active {
        transform: translateY(-1px) scale(0.98);
      }

      .btn:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        transform: none;
        animation: none;
      }

      .question {
        margin-bottom: 25px;
        padding: 20px;
        background: rgba(0, 0, 0, 0.9);
        border-radius: 15px;
        border: 1px solid #333;
        transition: all 0.3s ease;
        animation: questionSlide 0.6s ease forwards;
        opacity: 0;
        transform: translateX(-30px);
      }

      .question:hover {
        border-color: #00ffff;
        box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        transform: translateY(-2px);
      }

      @keyframes questionSlide {
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .question h3 {
        color: #ffffff;
        margin-bottom: 15px;
        font-size: 1rem;
        line-height: 1.4;
        font-weight: 600;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        background: rgba(0, 0, 0, 0.5);
        padding: 10px;
        border-radius: 8px;
        border-left: 3px solid #00ffff;
      }

      .likert-scale {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 8px;
        margin-top: 15px;
      }

      .likert-option {
        display: flex;
        flex-direction: column;
        align-items: center;
        cursor: pointer;
      }

      .likert-option input[type="radio"] {
        display: none;
      }

      .likert-circle {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        border: 2px solid #333;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1rem;
        color: #ffffff;
        transition: all 0.3s ease;
        margin-bottom: 8px;
        position: relative;
        background: rgba(0, 0, 0, 0.9);
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
      }

      .likert-option:hover .likert-circle {
        border-color: #00ffff;
        color: #00ffff;
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
        transform: scale(1.1);
      }

      .likert-option input[type="radio"]:checked + .likert-circle {
        background: linear-gradient(135deg, #ff1493, #00ffff);
        border-color: #ff1493;
        color: #ffffff;
        box-shadow: 0 0 20px rgba(255, 20, 147, 0.7),
          inset 0 0 15px rgba(0, 255, 255, 0.3);
        transform: scale(1.15);
        animation: checkGlow 0.6s ease;
      }

      @keyframes checkGlow {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.25);
        }
        100% {
          transform: scale(1.15);
        }
      }

      .likert-label {
        font-size: 0.75rem;
        color: #ffffff;
        text-align: center;
        line-height: 1.1;
        font-weight: 500;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        background: rgba(0, 0, 0, 0.7);
        padding: 4px 6px;
        border-radius: 6px;
      }

      .progress-bar {
        width: 100%;
        height: 12px;
        background: rgba(0, 0, 0, 0.8);
        border-radius: 12px;
        margin-bottom: 20px;
        overflow: hidden;
        position: relative;
        border: 2px solid #333;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #ff1493, #00ffff, #9932cc, #ff1493);
        background-size: 300% 100%;
        border-radius: 12px;
        transition: width 0.8s ease;
        width: 0%;
        animation: progressFlow 2s ease infinite;
        position: relative;
        box-shadow: 0 0 20px rgba(255, 20, 147, 0.6);
      }

      @keyframes progressFlow {
        0% {
          background-position: 0% 50%;
        }
        100% {
          background-position: 300% 50%;
        }
      }

      .transition-screen {
        text-align: center;
      }

      .transition-icon {
        font-size: 4rem;
        margin-bottom: 20px;
        animation: rotateGlow 2s ease infinite;
        filter: drop-shadow(0 0 15px #00ffff);
      }

      @keyframes rotateGlow {
        0%,
        100% {
          transform: rotate(0deg) scale(1);
        }
        25% {
          transform: rotate(90deg) scale(1.1);
        }
        50% {
          transform: rotate(180deg) scale(1);
        }
        75% {
          transform: rotate(270deg) scale(1.1);
        }
      }

      /* MODAL STYLES */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        z-index: 2000;
        animation: modalFadeIn 0.5s ease;
        padding: 10px;
      }

      .modal.active {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background: rgba(5, 5, 5, 0.98);
        backdrop-filter: blur(30px);
        border-radius: 20px;
        padding: 25px;
        max-width: 95%;
        max-height: 95%;
        overflow-y: auto;
        position: relative;
        animation: modalSlideIn 0.6s ease;
        border: 2px solid transparent;
        background-clip: padding-box;
        width: 100%;
        max-width: 600px;
      }

      .modal-content::before {
        content: "";
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, #00ffff, #ff1493, #9932cc, #00ffff);
        border-radius: 20px;
        z-index: -1;
        animation: borderGlow 2s ease infinite;
      }

      @keyframes modalFadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes modalSlideIn {
        from {
          transform: scale(0.8) translateY(30px);
          opacity: 0;
        }
        to {
          transform: scale(1) translateY(0);
          opacity: 1;
        }
      }

      /* DISCLAIMER MODAL */
      .disclaimer-modal {
        background: rgba(15, 15, 15, 0.98);
        border: 3px solid #ff6b35;
        max-width: 500px;
        text-align: center;
        animation: disclaimerPulse 2s ease infinite;
      }

      @keyframes disclaimerPulse {
        0%,
        100% {
          box-shadow: 0 0 0 0 rgba(255, 107, 53, 0.7);
          transform: scale(1);
        }
        50% {
          box-shadow: 0 0 0 15px rgba(255, 107, 53, 0);
          transform: scale(1.02);
        }
      }

      .disclaimer-content {
        color: #ffffff;
        font-size: 1.1rem;
        line-height: 1.6;
        margin-bottom: 25px;
        font-weight: 500;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
      }

      .age-input {
        width: 100%;
        padding: 15px;
        border-radius: 10px;
        border: 2px solid #333;
        background: rgba(0, 0, 0, 0.8);
        color: #fff;
        font-size: 1.1rem;
        text-align: center;
        margin: 20px 0;
        transition: all 0.3s ease;
      }

      .age-input:focus {
        outline: none;
        border-color: #00ffff;
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
      }

      .age-input::placeholder {
        color: #888;
      }

      .disclaimer-title {
        font-size: 1.5rem;
        font-weight: 800;
        color: #ff6b35;
        margin-bottom: 20px;
        font-family: "Orbitron", monospace;
        text-transform: uppercase;
      }

      /* RESULTS STYLES */
      .result-header {
        text-align: center;
        margin-bottom: 30px;
      }

      .result-icon {
        font-size: 4rem;
        margin-bottom: 15px;
        animation: resultBounce 2s ease infinite;
        filter: drop-shadow(0 0 15px currentColor);
      }

      @keyframes resultBounce {
        0%,
        100% {
          transform: translateY(0) scale(1);
        }
        50% {
          transform: translateY(-10px) scale(1.05);
        }
      }

      .scores-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
        margin: 25px 0;
      }

      .score-display {
        background: rgba(0, 0, 0, 0.95);
        border-radius: 20px;
        padding: 25px;
        text-align: center;
        border: 2px solid #333;
        transition: all 0.3s ease;
        position: relative;
      }

      .score-display:hover {
        border-color: #00ffff;
        box-shadow: 0 0 25px rgba(0, 255, 255, 0.3);
        transform: translateY(-3px);
      }

      .score-number {
        font-size: 3.5rem;
        font-weight: 900;
        font-family: "Orbitron", monospace;
        background: linear-gradient(45deg, #ff1493, #00ffff);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        animation: scoreGlow 2s ease infinite;
        text-shadow: 0 0 20px rgba(255, 20, 147, 0.5);
      }

      @keyframes scoreGlow {
        0%,
        100% {
          filter: drop-shadow(0 0 8px rgba(255, 20, 147, 0.8));
        }
        50% {
          filter: drop-shadow(0 0 20px rgba(0, 255, 255, 0.8));
        }
      }

      .score-label {
        font-size: 1.1rem;
        color: #ffffff;
        margin-top: 8px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 1px;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
      }

      .risk-level {
        padding: 10px 20px;
        border-radius: 25px;
        display: inline-block;
        font-weight: 700;
        margin: 12px 0;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-family: "Orbitron", monospace;
      }

      .risk-low {
        background: linear-gradient(135deg, #00ff88, #00ffaa);
        color: #000000;
        box-shadow: 0 0 15px rgba(0, 255, 136, 0.5);
      }

      .risk-medium {
        background: linear-gradient(135deg, #ffaa00, #ff8800);
        color: #000000;
        box-shadow: 0 0 15px rgba(255, 170, 0, 0.5);
      }

      .risk-high {
        background: linear-gradient(135deg, #ff0044, #ff0066);
        color: #ffffff;
        box-shadow: 0 0 15px rgba(255, 0, 68, 0.5);
      }

      /* PROFESSIONAL STATISTICS */
      .stats-container {
        margin: 20px 0;
        padding: 20px;
        background: rgba(0, 0, 0, 0.8);
        border-radius: 15px;
        border: 1px solid #333;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 15px;
        margin: 15px 0;
      }

      .stat-item {
        text-align: center;
        padding: 15px;
        background: rgba(0, 0, 0, 0.6);
        border-radius: 12px;
        border: 1px solid #444;
      }

      .stat-value {
        font-size: 1.5rem;
        font-weight: 800;
        color: #00ffff;
        font-family: "Orbitron", monospace;
      }

      .stat-label {
        font-size: 0.8rem;
        color: #cccccc;
        margin-top: 5px;
        text-transform: uppercase;
      }

      .category-breakdown {
        margin: 20px 0;
      }

      .category-item {
        margin: 10px 0;
        padding: 15px;
        background: rgba(0, 0, 0, 0.6);
        border-radius: 12px;
        border-left: 4px solid #00ffff;
      }

      .category-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .category-name {
        font-weight: 600;
        color: #ffffff;
      }

      .category-score {
        font-weight: 700;
        color: #00ffff;
        font-family: "Orbitron", monospace;
      }

      .category-bar {
        width: 100%;
        height: 8px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
        overflow: hidden;
      }

      .category-fill {
        height: 100%;
        background: linear-gradient(90deg, #ff1493, #00ffff);
        border-radius: 4px;
        transition: width 1s ease;
        animation: categoryGlow 2s ease infinite;
      }

      @keyframes categoryGlow {
        0%,
        100% {
          box-shadow: 0 0 5px rgba(255, 20, 147, 0.5);
        }
        50% {
          box-shadow: 0 0 15px rgba(0, 255, 255, 0.8);
        }
      }

      .couple-result {
        background: rgba(0, 0, 0, 0.95);
        border-radius: 20px;
        padding: 25px;
        margin: 25px 0;
        text-align: center;
        border: 2px solid #333;
      }

      .couple-classification {
        font-size: 1.5rem;
        font-weight: 800;
        margin: 15px 0;
        font-family: "Orbitron", monospace;
        background: linear-gradient(45deg, #ff1493, #00ffff, #9932cc);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .betrayal-index {
        font-size: 2.5rem;
        font-weight: 900;
        font-family: "Orbitron", monospace;
        color: #ff0044;
        margin: 15px 0;
        text-shadow: 0 0 15px rgba(255, 0, 68, 0.8);
        animation: betrayalPulse 2s ease infinite;
      }

      @keyframes betrayalPulse {
        0%,
        100% {
          transform: scale(1);
          text-shadow: 0 0 15px rgba(255, 0, 68, 0.8);
        }
        50% {
          transform: scale(1.03);
          text-shadow: 0 0 25px rgba(255, 0, 68, 1);
        }
      }

      .analysis-text {
        line-height: 1.5;
        color: #ffffff;
        margin: 15px 0;
        font-weight: 500;
        background: rgba(0, 0, 0, 0.7);
        padding: 15px;
        border-radius: 12px;
        border-left: 3px solid #00ffff;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        font-size: 0.95rem;
      }

      .modal-actions {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 25px;
      }

      .close-modal {
        position: absolute;
        top: 15px;
        right: 20px;
        background: none;
        border: none;
        font-size: 2rem;
        cursor: pointer;
        color: #cccccc;
        width: auto;
        padding: 0;
        margin: 0;
        transition: all 0.3s ease;
      }

      .close-modal:hover {
        color: #ff1493;
        transform: scale(1.2) rotate(90deg);
        text-shadow: 0 0 15px #ff1493;
      }

      .sound-toggle {
        position: fixed;
        top: 15px;
        right: 15px;
        background: linear-gradient(135deg, #ff1493, #00ffff);
        border: none;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
        color: white;
        cursor: pointer;
        z-index: 1000;
        transition: all 0.3s ease;
        box-shadow: 0 0 15px rgba(255, 20, 147, 0.5);
      }

      .sound-toggle:hover {
        transform: scale(1.1);
        box-shadow: 0 0 25px rgba(0, 255, 255, 0.7);
      }

      .comparison-chart {
        margin: 20px 0;
        padding: 20px;
        background: rgba(0, 0, 0, 0.8);
        border-radius: 15px;
        border: 1px solid #333;
      }

      .chart-title {
        text-align: center;
        color: #00ffff;
        font-weight: 700;
        margin-bottom: 15px;
        font-family: "Orbitron", monospace;
      }

      .chart-bars {
        display: flex;
        justify-content: space-around;
        align-items: end;
        height: 150px;
        margin: 20px 0;
      }

      .chart-bar {
        width: 40px;
        background: linear-gradient(0deg, #ff1493, #00ffff);
        border-radius: 8px 8px 0 0;
        position: relative;
        transition: height 1.5s ease;
        box-shadow: 0 0 10px rgba(255, 20, 147, 0.5);
      }

      .chart-bar::after {
        content: attr(data-value) "%";
        position: absolute;
        top: -25px;
        left: 50%;
        transform: translateX(-50%);
        color: #ffffff;
        font-weight: 700;
        font-size: 0.9rem;
      }

      .chart-label {
        text-align: center;
        color: #cccccc;
        font-size: 0.8rem;
        margin-top: 10px;
        font-weight: 600;
      }

      /* Responsividad específica */
      @media (max-width: 480px) {
        .container {
          padding: 5px;
        }

        .screen {
          padding: 15px;
          border-radius: 15px;
          margin: 5px;
        }

        h1 {
          font-size: 1.4rem;
          letter-spacing: 1px;
          margin-bottom: 10px;
        }

        .role-selector {
          grid-template-columns: 1fr;
          gap: 12px;
        }

        .role-btn {
          padding: 15px 10px;
        }

        .role-icon {
          font-size: 2rem;
        }

        .likert-scale {
          gap: 6px;
        }

        .likert-circle {
          width: 38px;
          height: 38px;
          font-size: 0.9rem;
        }

        .likert-label {
          font-size: 0.7rem;
        }

        .modal-content {
          padding: 15px;
          margin: 5px;
          border-radius: 15px;
        }

        .scores-grid {
          grid-template-columns: 1fr;
          gap: 15px;
        }

        .score-number {
          font-size: 2.8rem;
        }

        .couple-classification {
          font-size: 1.2rem;
        }

        .betrayal-index {
          font-size: 2rem;
        }

        .modal-actions {
          grid-template-columns: 1fr;
          gap: 10px;
        }

        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 10px;
        }

        .chart-bars {
          height: 120px;
        }

        .chart-bar {
          width: 30px;
        }
      }

      @media (min-width: 481px) and (max-width: 768px) {
        .container {
          padding: 10px;
        }

        .screen {
          padding: 25px;
          max-width: 600px;
        }

        h1 {
          font-size: 2rem;
        }

        .scores-grid {
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }
      }

      @media (min-width: 769px) {
        .container {
          padding: 20px;
        }

        .screen {
          padding: 30px;
          max-width: 700px;
        }

        h1 {
          font-size: 2.2rem;
        }

        .scores-grid {
          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }
      }

      /* Mejoras para landscape en móviles */
      @media (max-height: 500px) and (orientation: landscape) {
        .screen {
          margin: 5px 0;
          max-height: 90vh;
          overflow-y: auto;
        }

        h1 {
          font-size: 1.3rem;
          margin-bottom: 8px;
        }

        .role-selector {
          margin: 15px 0;
        }

        .role-btn {
          padding: 12px 8px;
        }

        .role-icon {
          font-size: 1.8rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Grid cibernético -->
    <div class="cyber-grid"></div>

    <!-- Corazones 3D flotantes -->
    <div class="floating-hearts" id="floating-hearts"></div>

    <!-- Partículas neón -->
    <div class="neon-particles" id="neon-particles"></div>

    <!-- Toggle de sonido -->
    <button class="sound-toggle" id="sound-toggle" onclick="toggleSound()">
      🔊
    </button>

    <!-- Modal de Edad -->
    <div class="modal active" id="age-modal">
      <div class="modal-content disclaimer-modal">
        <div class="disclaimer-title">🎂 VERIFICACIÓN DE EDAD</div>
        <div class="disclaimer-content">
          Para ofrecerte la mejor experiencia, necesitamos saber tu edad. Esto
          determinará el tipo de preguntas que recibirás.
        </div>
        <div style="margin: 20px 0">
          <input
            type="number"
            id="age-input"
            class="age-input"
            placeholder="Ingresa tu edad"
            min="13"
            max="99"
          />
        </div>
        <button
          class="btn"
          onclick="verifyAge()"
          id="age-continue-btn"
          disabled
        >
          CONTINUAR
        </button>
      </div>
    </div>

    <!-- Modal Disclaimer -->
    <div class="modal" id="disclaimer-modal">
      <div class="modal-content disclaimer-modal">
        <div class="disclaimer-title">⚠️ REAL TALK</div>
        <div class="disclaimer-content" id="disclaimer-text">
          Este test es para que reflexionen y se diviertan. No es medicina ni
          nada científico. Si tienen problemas serios, hablen con un profesional
          de verdad.
        </div>
        <button class="btn" onclick="acceptDisclaimer()">
          ACEPTO Y CONTINÚO
        </button>
      </div>
    </div>

    <div class="container">
      <!-- Pantalla de inicio -->
      <div class="screen" id="start-screen">
        <h1>💘 Test de Fuerza Relacional</h1>
        <p class="subtitle">
          Descubre qué tan real es tu conexión. 35 preguntas que van directo al
          grano. ¿Están listos para la verdad sin filtros? 🌶️
        </p>

        <div class="role-selector">
          <div
            class="role-btn"
            data-role="novio"
            onclick="selectRole(this, 'novio')"
          >
            <span class="role-icon">👨</span>
            <div>Comenzar como Él</div>
          </div>
          <div
            class="role-btn"
            data-role="novia"
            onclick="selectRole(this, 'novia')"
          >
            <span class="role-icon">👩</span>
            <div>Comenzar como Ella</div>
          </div>
        </div>

        <button class="btn" id="start-test" disabled onclick="startTest()">
          EMPEZAR
        </button>
      </div>

      <!-- Pantalla del test -->
      <div class="screen" id="test-screen">
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>

        <h2 id="test-title">Test - Parte 1</h2>
        <div id="questions-container"></div>
        <button
          class="btn"
          id="continue-test"
          disabled
          onclick="handleContinue()"
        >
          CONTINUAR
        </button>
      </div>

      <!-- Pantalla de transición -->
      <div class="screen transition-screen" id="transition-screen">
        <div class="transition-icon">🔄</div>
        <h2>¡Listo!</h2>
        <p class="subtitle">
          Tu parte está completa. Ahora pásale el dispositivo a tu pareja para
          que haga la suya. ¡No hagas trampa! 😏
        </p>
        <button class="btn" onclick="startPartnerTest()">CONTINUAR</button>
      </div>

      <!-- Pantalla de carga -->
      <div class="screen" id="loading-screen">
        <div style="text-align: center">
          <div
            style="
              font-size: 4rem;
              margin-bottom: 20px;
              animation: rotateGlow 1s ease infinite;
            "
          >
            🔮
          </div>
          <h2>Analizando datos...</h2>
          <p class="subtitle">
            Procesando toda la info. Preparando tu análisis real, sin filtros...
          </p>
        </div>
      </div>
    </div>

    <!-- Modal de resultados -->
    <div class="modal" id="results-modal">
      <div class="modal-content">
        <button class="close-modal" onclick="closeModal()">&times;</button>
        <div id="results-content"></div>
        <div class="modal-actions">
          <button class="btn" onclick="restartTest()">OTRA VEZ</button>
          <button class="btn" onclick="shareResult()">COMPARTIR</button>
        </div>
      </div>
    </div>

    <script>
      // Variables globales
      let currentRole = "";
      let currentQuestionIndex = 0;
      let currentPartner = 1;
      let responses = {
        partner1: {},
        partner2: {},
      };
      let partner1Role = "";
      let partner2Role = "";
      let soundEnabled = true;
      let selectedQuestions = [];
      let userAge = null;
      let isAdult = false;

      // Audio Context y efectos de sonido
      let audioContext;
      let soundEffects = {};

      // Pool de preguntas NORMALES para menores de 18 (80 preguntas)
      const questionPoolNormal = [
        // Conexión Emocional Normal (20 preguntas)
        {
          category: "Conexión Emocional",
          text: "Mi pareja realmente me entiende cuando le cuento mis cosas 💯",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "A veces siento que estamos en diferentes ondas 😐",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Puedo contarle cualquier cosa sin que me juzgue 🗣️",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "Siento que cada uno va por su lado 🔄",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Cuando me pasa algo importante, es lo primero que pienso en contarle 📱",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "Mi pareja me hace sentir seguro/a emocionalmente 🛡️",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "A veces siento que hablo con una pared cuando le cuento algo 🧱",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Nos divertimos juntos como cuando empezamos 😄",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "Siento que ya no tenemos cosas de qué hablar 😶",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Mi pareja es mi mejor amigo/a 👫",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "Me siento solo/a aunque esté con mi pareja 😔",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Compartimos los mismos valores importantes 🎯",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "Siento que mi pareja no me conoce realmente 🎭",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Cuando estoy triste, mi pareja sabe cómo animarme 🤗",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "A menudo me siento incomprendido/a en esta relación 😕",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Mi pareja conoce mis secretos más importantes 🔐",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "Prefiero estar solo/a que pasar tiempo con mi pareja 🏠",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Nos reímos juntos casi todos los días 😂",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "Siento que fingimos ser felices la mayor parte del tiempo 🎭",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Mi pareja me inspira a ser mejor persona 🌟",
          reverse: false,
        },

        // Atracción y Romance Normal (20 preguntas)
        {
          category: "Atracción y Romance",
          text: "Todavía me siento atraído/a hacia mi pareja 🔥",
          reverse: false,
        },
        {
          category: "Atracción y Romance",
          text: "A veces me fijo en otras personas de manera romántica 💭",
          reverse: true,
        },
        {
          category: "Atracción y Romance",
          text: "Mi pareja sigue siendo muy atractivo/a para mí 💫",
          reverse: false,
        },
        {
          category: "Atracción y Romance",
          text: "Ya no siento esa chispa especial 💔",
          reverse: true,
        },
        {
          category: "Atracción y Romance",
          text: "Para mí sigue siendo la persona más linda del mundo 😍",
          reverse: false,
        },
        {
          category: "Atracción y Romance",
          text: "Me emociono cuando voy a ver a mi pareja ✨",
          reverse: false,
        },
        {
          category: "Atracción y Romance",
          text: "He perdido el interés romántico 😴",
          reverse: true,
        },
        {
          category: "Atracción y Romance",
          text: "Mi pareja aún me pone nervioso/a de la buena manera 🦋",
          reverse: false,
        },
        {
          category: "Atracción y Romance",
          text: "Evito el contacto físico con mi pareja 🚫",
          reverse: true,
        },
        {
          category: "Atracción y Romance",
          text: "Me gusta cómo me ve mi pareja 👀",
          reverse: false,
        },
        {
          category: "Atracción y Romance",
          text: "Siento más atracción por otras personas 👥",
          reverse: true,
        },
        {
          category: "Atracción y Romance",
          text: "Aún me dan ganas de besarlo/a cuando lo/la veo 💋",
          reverse: false,
        },
        {
          category: "Atracción y Romance",
          text: "La relación se siente más como amistad 🤝",
          reverse: true,
        },
        {
          category: "Atracción y Romance",
          text: "Mi pareja me sigue pareciendo increíble 🔥",
          reverse: false,
        },
        {
          category: "Atracción y Romance",
          text: "Ya no me emociona estar romántico/a con mi pareja 😑",
          reverse: true,
        },
        {
          category: "Atracción y Romance",
          text: "Cuando mi pareja me abraza, me siento completo/a 🤗",
          reverse: false,
        },
        {
          category: "Atracción y Romance",
          text: "He comparado a mi pareja con otras personas 📊",
          reverse: true,
        },
        {
          category: "Atracción y Romance",
          text: "Mi pareja aún me hace sonrojar 😊",
          reverse: false,
        },
        {
          category: "Atracción y Romance",
          text: "A veces pienso en cómo sería estar con alguien más 🤔",
          reverse: true,
        },
        {
          category: "Atracción y Romance",
          text: "No puedo imaginarme besando a alguien más 💋",
          reverse: false,
        },

        // Comunicación Normal (20 preguntas)
        {
          category: "Comunicación",
          text: "Podemos hablar de cualquier tema sin problemas 💬",
          reverse: false,
        },
        {
          category: "Comunicación",
          text: "Evito las conversaciones difíciles 😵",
          reverse: true,
        },
        {
          category: "Comunicación",
          text: "Confío en que mi pareja me dice la verdad ✨",
          reverse: false,
        },
        {
          category: "Comunicación",
          text: "He ocultado cosas importantes últimamente 🤫",
          reverse: true,
        },
        {
          category: "Comunicación",
          text: "Cuando discutimos, terminamos arreglando las cosas 🤝",
          reverse: false,
        },
        {
          category: "Comunicación",
          text: "Mi pareja realmente me escucha 👂",
          reverse: false,
        },
        {
          category: "Comunicación",
          text: "A menudo siento que no me presta atención 📱",
          reverse: true,
        },
        {
          category: "Comunicación",
          text: "Podemos bromear y reírnos juntos fácilmente 😂",
          reverse: false,
        },
        {
          category: "Comunicación",
          text: "Las discusiones se vuelven muy intensas 😤",
          reverse: true,
        },
        {
          category: "Comunicación",
          text: "Mi pareja respeta mis opiniones 🤔",
          reverse: false,
        },
        {
          category: "Comunicación",
          text: "Siento que tengo que cuidar lo que digo 🥚",
          reverse: true,
        },
        {
          category: "Comunicación",
          text: "Nos comunicamos mejor ahora que al principio 📈",
          reverse: false,
        },
        {
          category: "Comunicación",
          text: "Prefiero contarle mis problemas a otras personas 👥",
          reverse: true,
        },
        {
          category: "Comunicación",
          text: "Mi pareja me hace sentir escuchado/a 💝",
          reverse: false,
        },
        {
          category: "Comunicación",
          text: "A menudo no nos entendemos 🤷",
          reverse: true,
        },
        {
          category: "Comunicación",
          text: "Podemos hablar de nuestros sentimientos abiertamente ❤️",
          reverse: false,
        },
        {
          category: "Comunicación",
          text: "A veces finjo estar de acuerdo para evitar conflictos 🎭",
          reverse: true,
        },
        {
          category: "Comunicación",
          text: "Mi pareja nota cuando algo me molesta 🔍",
          reverse: false,
        },
        {
          category: "Comunicación",
          text: "Hay temas que evitamos hablar ❌",
          reverse: true,
        },
        {
          category: "Comunicación",
          text: "Nos entendemos sin necesidad de palabras 🤐",
          reverse: false,
        },

        // Compromiso y Futuro Normal (20 preguntas)
        {
          category: "Compromiso y Futuro",
          text: "No me imagino mi futuro sin mi pareja 🌟",
          reverse: false,
        },
        {
          category: "Compromiso y Futuro",
          text: "A veces pienso que podría ser más feliz solo/a 🤔",
          reverse: true,
        },
        {
          category: "Compromiso y Futuro",
          text: "Estoy 100% comprometido/a con esta relación 💯",
          reverse: false,
        },
        {
          category: "Compromiso y Futuro",
          text: "He pensado en terminar la relación 💔",
          reverse: true,
        },
        {
          category: "Compromiso y Futuro",
          text: "Mi pareja es mi prioridad número uno 🥇",
          reverse: false,
        },
        {
          category: "Compromiso y Futuro",
          text: "A veces dudo si esta es la persona correcta 🤷",
          reverse: true,
        },
        {
          category: "Compromiso y Futuro",
          text: "Defiendo a mi pareja cuando otros la critican 🛡️",
          reverse: false,
        },
        {
          category: "Compromiso y Futuro",
          text: "He considerado estar con alguien más 👥",
          reverse: true,
        },
        {
          category: "Compromiso y Futuro",
          text: "Mi pareja es irreemplazable para mí 💎",
          reverse: false,
        },
        {
          category: "Compromiso y Futuro",
          text: "A veces fantaseo con terminar esto 🚪",
          reverse: true,
        },
        {
          category: "Compromiso y Futuro",
          text: "Elijo a mi pareja todos los días 💕",
          reverse: false,
        },
        {
          category: "Compromiso y Futuro",
          text: "He perdido la ilusión en esta relación 😔",
          reverse: true,
        },
        {
          category: "Compromiso y Futuro",
          text: "Mi pareja es mi persona favorita en el mundo 🌍",
          reverse: false,
        },
        {
          category: "Compromiso y Futuro",
          text: "A veces siento que estoy perdiendo el tiempo ⏰",
          reverse: true,
        },
        {
          category: "Compromiso y Futuro",
          text: "Quiero envejecer junto a mi pareja 👴👵",
          reverse: false,
        },
        {
          category: "Compromiso y Futuro",
          text: "He pensado en cómo sería mi vida sin mi pareja 🤔",
          reverse: true,
        },
        {
          category: "Compromiso y Futuro",
          text: "Haría cualquier cosa por salvar esta relación 💪",
          reverse: false,
        },
        {
          category: "Compromiso y Futuro",
          text: "A veces me siento atrapado/a en esta relación 🔒",
          reverse: true,
        },
        {
          category: "Compromiso y Futuro",
          text: "Mi pareja y yo tenemos los mismos planes de vida 🎯",
          reverse: false,
        },
        {
          category: "Compromiso y Futuro",
          text: "He dudado si realmente amo a mi pareja ❓",
          reverse: true,
        },
      ];

      // Pool de preguntas PICANTES para adultos +18 (120 preguntas simplificadas)
      const questionPoolAdult = [
        // Conexión Emocional (30 preguntas)
        {
          category: "Conexión Emocional",
          text: "Mi pareja realmente me entiende cuando le cuento mis cosas 💯",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "Muchas veces siento que estamos en diferentes ondas 😐",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Puedo contarle cualquier cosa sin que me juzgue 🗣️",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "Siento que cada uno va por su lado 🔄",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Cuando me pasa algo bueno o malo, es lo primero que pienso en contarle 📱",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "Mi pareja me hace sentir seguro/a emocionalmente 🛡️",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "A veces siento que hablo con una pared cuando le cuento algo 🧱",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Nos divertimos juntos como cuando empezamos 😄",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "Siento que ya no tenemos nada de qué hablar 😶",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Mi pareja es mi mejor amigo/a 👫",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "Me siento solo/a aunque esté con mi pareja 😔",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Compartimos los mismos valores importantes 🎯",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "Siento que mi pareja no me conoce realmente 🎭",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Cuando estoy triste, mi pareja sabe cómo consolarme 🤗",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "A menudo me siento incomprendido/a en esta relación 😕",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Mi pareja conoce mis secretos más profundos 🔐",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "Prefiero estar solo/a que pasar tiempo con mi pareja 🏠",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Nos reímos juntos todos los días 😂",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "Siento que fingimos ser felices la mayor parte del tiempo 🎭",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Mi pareja me inspira a ser mejor persona 🌟",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "Ya no compartimos sueños o planes juntos 💭",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Me siento completamente cómodo/a siendo yo mismo/a con mi pareja 😌",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "Evito mostrar mis verdaderas emociones a mi pareja 😶",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Mi pareja me hace sentir especial y único/a ✨",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "Siento que somos como extraños viviendo juntos 👥",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Tenemos tradiciones y rituales que nos unen 🎊",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "Ya no me importa lo que piense mi pareja sobre mí 🤷",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Mi pareja es la primera persona que quiero ver cuando llego a casa 🏡",
          reverse: false,
        },
        {
          category: "Conexión Emocional",
          text: "Me aburro cuando estamos juntos sin hacer nada 😴",
          reverse: true,
        },
        {
          category: "Conexión Emocional",
          text: "Podemos estar en silencio y sentirme completamente conectado/a 🤐",
          reverse: false,
        },

        // Deseo y Atracción (30 preguntas) - MÁS CALIENTES
        {
          category: "Deseo y Atracción",
          text: "Todavía me atrae físicamente como al principio 🔥",
          reverse: false,
        },
        {
          category: "Deseo y Atracción",
          text: "A veces fantaseo con otras personas 💭",
          reverse: true,
        },
        {
          category: "Deseo y Atracción",
          text: "La intimidad con mi pareja me deja satisfecho/a 💫",
          reverse: false,
        },
        {
          category: "Deseo y Atracción",
          text: "Ya no siento esa chispa romántica 💔",
          reverse: true,
        },
        {
          category: "Deseo y Atracción",
          text: "Para mí sigue siendo la persona más atractiva del mundo 😍",
          reverse: false,
        },
        {
          category: "Deseo y Atracción",
          text: "He pensado en alguien más durante la intimidad con mi pareja 🙈",
          reverse: true,
        },
        {
          category: "Deseo y Atracción",
          text: "Mi pareja aún me excita solo con mirarme 👀",
          reverse: false,
        },
        {
          category: "Deseo y Atracción",
          text: "He comparado físicamente a mi pareja con otras personas 📏",
          reverse: true,
        },
        {
          category: "Deseo y Atracción",
          text: "Aún tengo ganas de tocar a mi pareja cuando la veo 🤲",
          reverse: false,
        },
        {
          category: "Deseo y Atracción",
          text: "Me siento más atraído/a hacia personas en redes sociales que hacia mi pareja 📱",
          reverse: true,
        },
        {
          category: "Deseo y Atracción",
          text: "Mi pareja me sigue poniendo nervioso/a cuando me toca 🦋",
          reverse: false,
        },
        {
          category: "Deseo y Atracción",
          text: "He sentido deseo sexual por alguien que conozco en persona 🔥",
          reverse: true,
        },
        {
          category: "Deseo y Atracción",
          text: "La pasión entre nosotros sigue siendo intensa 🌶️",
          reverse: false,
        },
        {
          category: "Deseo y Atracción",
          text: "He fantaseado con actores/actrices o influencers 🎬",
          reverse: true,
        },
        {
          category: "Deseo y Atracción",
          text: "Mi pareja conoce exactamente cómo satisfacerme 💯",
          reverse: false,
        },
        {
          category: "Deseo y Atracción",
          text: "He mirado con deseo a otras personas cuando estoy con mi pareja 👁️",
          reverse: true,
        },
        {
          category: "Deseo y Atracción",
          text: "Siento mariposas en el estómago cuando mi pareja me besa 💋",
          reverse: false,
        },
        {
          category: "Deseo y Atracción",
          text: "He pensado en experiencias sexuales con alguien específico que no es mi pareja 🤫",
          reverse: true,
        },
        {
          category: "Deseo y Atracción",
          text: "Mi pareja sigue siendo mi fantasía sexual principal 🔥",
          reverse: false,
        },
        {
          category: "Deseo y Atracción",
          text: "He sentido atracción física fuerte por un amigo/a 👥",
          reverse: true,
        },
        {
          category: "Deseo y Atracción",
          text: "Me emociono sexualmente pensando en mi pareja 🤤",
          reverse: false,
        },
        {
          category: "Deseo y Atracción",
          text: "He coqueteado con alguien más aunque sea 'jugando' 😉",
          reverse: true,
        },
        {
          category: "Deseo y Atracción",
          text: "Mi pareja me enciende con solo susurrarme al oído 🗣️",
          reverse: false,
        },
        {
          category: "Deseo y Atracción",
          text: "He sentido que alguien más me entiende mejor sexualmente 💭",
          reverse: true,
        },
        {
          category: "Deseo y Atracción",
          text: "La química sexual con mi pareja sigue siendo explosiva 💥",
          reverse: false,
        },
        {
          category: "Deseo y Atracción",
          text: "He tenido sueños eróticos con personas que no son mi pareja 😴",
          reverse: true,
        },
        {
          category: "Deseo y Atracción",
          text: "Mi pareja sabe exactamente cómo prenderme 🔥",
          reverse: false,
        },
        {
          category: "Deseo y Atracción",
          text: "He sentido ganas de experimentar cosas nuevas con alguien más 🆕",
          reverse: true,
        },
        {
          category: "Deseo y Atracción",
          text: "No puedo mantener las manos quietas cuando estoy cerca de mi pareja 👐",
          reverse: false,
        },
        {
          category: "Deseo y Atracción",
          text: "He sentido curiosidad sexual por personas del trabajo/estudio 🏢",
          reverse: true,
        },

        // Comunicación y Honestidad (30 preguntas)
        {
          category: "Comunicación y Honestidad",
          text: "Podemos hablar de cualquier tema sin dramas 💬",
          reverse: false,
        },
        {
          category: "Comunicación y Honestidad",
          text: "Evito las conversaciones difíciles porque siempre terminan mal 😵",
          reverse: true,
        },
        {
          category: "Comunicación y Honestidad",
          text: "Confío en que mi pareja siempre me dice la verdad ✨",
          reverse: false,
        },
        {
          category: "Comunicación y Honestidad",
          text: "He ocultado cosas importantes últimamente 🤫",
          reverse: true,
        },
        {
          category: "Comunicación y Honestidad",
          text: "Cuando discutimos, terminamos arreglando las cosas bien 🤝",
          reverse: false,
        },
        {
          category: "Comunicación y Honestidad",
          text: "He mentido sobre con quién estuve o dónde fui 🤥",
          reverse: true,
        },
        {
          category: "Comunicación y Honestidad",
          text: "Mi pareja y yo hablamos de nuestros miedos sin juzgarnos 😰",
          reverse: false,
        },
        {
          category: "Comunicación y Honestidad",
          text: "He borrado mensajes para que mi pareja no los vea 📱",
          reverse: true,
        },
        {
          category: "Comunicación y Honestidad",
          text: "Podemos resolver cualquier conflicto hablando 🗣️",
          reverse: false,
        },
        {
          category: "Comunicación y Honestidad",
          text: "He guardado secretos sobre mis sentimientos hacia otras personas 🤐",
          reverse: true,
        },
        {
          category: "Comunicación y Honestidad",
          text: "Mi pareja conoce mis inseguridades más profundas 💔",
          reverse: false,
        },
        {
          category: "Comunicación y Honestidad",
          text: "He evitado contar detalles sobre salidas con amigos 🍺",
          reverse: true,
        },
        {
          category: "Comunicación y Honestidad",
          text: "Nos contamos todo lo que nos pasa en el día 📅",
          reverse: false,
        },
        {
          category: "Comunicación y Honestidad",
          text: "He fingido estar bien cuando en realidad estaba molesto/a 😤",
          reverse: true,
        },
        {
          category: "Comunicación y Honestidad",
          text: "Mi pareja me escucha sin interrumpir cuando necesito desahogarme 👂",
          reverse: false,
        },
        {
          category: "Comunicación y Honestidad",
          text: "He ocultado conversaciones con personas del pasado 📞",
          reverse: true,
        },
        {
          category: "Comunicación y Honestidad",
          text: "Podemos bromear sobre temas delicados sin lastimarnos 😄",
          reverse: false,
        },
        {
          category: "Comunicación y Honestidad",
          text: "He evitado mencionar a ciertas personas para no crear problemas 🚫",
          reverse: true,
        },
        {
          category: "Comunicación y Honestidad",
          text: "Mi pareja respeta cuando necesito espacio para procesar las cosas 🌌",
          reverse: false,
        },
        {
          category: "Comunicación y Honestidad",
          text: "He cambiado la verdad para evitar que mi pareja se moleste 🔄",
          reverse: true,
        },
        {
          category: "Comunicación y Honestidad",
          text: "Nos comunicamos mejor ahora que cuando empezamos 📈",
          reverse: false,
        },
        {
          category: "Comunicación y Honestidad",
          text: "He tenido pensamientos que nunca le confesaría a mi pareja 🧠",
          reverse: true,
        },
        {
          category: "Comunicación y Honestidad",
          text: "Mi pareja nota cuando algo me molesta aunque no lo diga 🔍",
          reverse: false,
        },
        {
          category: "Comunicación y Honestidad",
          text: "He usado mi teléfono de manera que mi pareja no pueda ver 📲",
          reverse: true,
        },
        {
          category: "Comunicación y Honestidad",
          text: "Podemos hablar de nuestro futuro juntos sin miedo 🔮",
          reverse: false,
        },
        {
          category: "Comunicación y Honestidad",
          text: "He evitado responder preguntas directas de mi pareja ❓",
          reverse: true,
        },
        {
          category: "Comunicación y Honestidad",
          text: "Mi pareja me hace sentir seguro/a para expresar mis opiniones 🛡️",
          reverse: false,
        },
        {
          category: "Comunicación y Honestidad",
          text: "He actuado como si no hubiera pasado nada cuando sí pasó algo 🎭",
          reverse: true,
        },
        {
          category: "Comunicación y Honestidad",
          text: "Tenemos conversaciones profundas regularmente 🌊",
          reverse: false,
        },
        {
          category: "Comunicación y Honestidad",
          text: "He mantenido contacto secreto con alguien del pasado 📧",
          reverse: true,
        },

        // Tentación y Deseo Externo (30 preguntas) - SÚPER CALIENTES
        {
          category: "Tentación y Deseo Externo",
          text: "He sentido atracción romántica fuerte por alguien que no es mi pareja 💘",
          reverse: true,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "No me imagino un futuro romántico con nadie más 🌟",
          reverse: false,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "He buscado conexión emocional profunda en otras personas 🔍",
          reverse: true,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "Estoy 100% comprometido/a emocionalmente con esta relación 💯",
          reverse: false,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "A veces pienso que podría ser más feliz con otra persona específica 🤔",
          reverse: true,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "He tenido fantasías románticas detalladas con alguien más 💭",
          reverse: true,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "Mi pareja es irreemplazable en todos los aspectos 💎",
          reverse: false,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "He sentido mariposas por alguien que no es mi pareja 🦋",
          reverse: true,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "Defiendo a mi pareja cuando otros la critican o insinúan cosas 🛡️",
          reverse: false,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "He imaginado cómo sería besar a alguien específico 💋",
          reverse: true,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "He pensado seriamente en cómo sería estar íntimamente con otra persona 🔥",
          reverse: true,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "Mi pareja satisface todos mis deseos emocionales y físicos 💕",
          reverse: false,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "He sentido conexión especial con alguien más que me preocupa 🚨",
          reverse: true,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "Elijo activamente a mi pareja sobre cualquier otra opción 💪",
          reverse: false,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "He tenido conversaciones íntimas que cruzaron la línea con alguien más 💬",
          reverse: true,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "He fantaseado con terminar mi relación para estar con alguien específico 💔",
          reverse: true,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "Mi pareja es mi única opción romántica real y verdadera 🎯",
          reverse: false,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "He sentido tentación real de hacer algo con alguien más 😈",
          reverse: true,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "He considerado seriamente si estaría mejor con alguien específico que conozco 🤷",
          reverse: true,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "Mi corazón le pertenece completamente a mi pareja actual 💖",
          reverse: false,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "He sentido que alguien más me entiende mejor que mi pareja 🧠",
          reverse: true,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "He tenido sueños románticos recurrentes con la misma persona 😴",
          reverse: true,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "No hay nadie en el mundo que me atraiga más que mi pareja 🌍",
          reverse: false,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "He pensado en cómo sería la vida diaria con alguien específico 🏠",
          reverse: true,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "He comparado emocionalmente a mi pareja con alguien más y mi pareja perdió 📊",
          reverse: true,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "Mi pareja es mi alma gemela y no necesito buscar en otro lado 👫",
          reverse: false,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "He sentido que tengo más química con alguien más ⚡",
          reverse: true,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "He tenido momentos donde casi cruzo la línea con alguien más 🚫",
          reverse: true,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "Mi compromiso con mi pareja es inquebrantable sin importar quién aparezca 🔒",
          reverse: false,
        },
        {
          category: "Tentación y Deseo Externo",
          text: "He sentido que alguien más podría hacerme más feliz en general 😊",
          reverse: true,
        },
      ];

      // Función para obtener el pool correcto según la edad
      function getQuestionPool() {
        if (isAdult) {
          return questionPoolAdult; // Para +18 (contenido picante)
        } else {
          return questionPoolNormal; // Para menores (contenido apropiado)
        }
      }

      // Inicialización
      document.addEventListener("DOMContentLoaded", function () {
        initializeAudio();
        setupEventListeners();
        create3DHearts();
        createNeonParticles();
        setupAgeInput();
        playStartSound();
      });

      function setupAgeInput() {
        const ageInput = document.getElementById("age-input");
        const continueBtn = document.getElementById("age-continue-btn");

        ageInput.addEventListener("input", function () {
          const age = parseInt(this.value);
          continueBtn.disabled = !age || age < 13 || age > 99;
        });

        ageInput.addEventListener("keypress", function (e) {
          if (e.key === "Enter" && !continueBtn.disabled) {
            verifyAge();
          }
        });
      }

      function verifyAge() {
        const age = parseInt(document.getElementById("age-input").value);
        if (age < 13 || age > 99) {
          alert("Por favor ingresa una edad válida");
          return;
        }

        userAge = age;
        isAdult = age >= 18;

        playSound("success");
        document.getElementById("age-modal").classList.remove("active");

        // Actualizar disclaimer según la edad
        const disclaimerText = document.getElementById("disclaimer-text");
        if (isAdult) {
          disclaimerText.innerHTML = `
                <strong>🔞 CONTENIDO PARA ADULTOS:</strong><br>
                Este test contiene preguntas con contenido sugerente y doble sentido. Es solo para reflexión y diversión. 
                No es un diagnóstico médico. Si tienen problemas reales de pareja, consulten con un profesional.
                <br><br>
                <strong>Edad detectada: ${userAge} años</strong> - Acceso a preguntas para adultos ✅
            `;
        } else {
          disclaimerText.innerHTML = `
                <strong>👶 VERSIÓN JOVEN:</strong><br>
                Este test contiene preguntas apropiadas para tu edad. Es para reflexión y diversión. 
                No es un diagnóstico médico. Si tienen problemas, hablen con un adulto de confianza o profesional.
                <br><br>
                <strong>Edad detectada: ${userAge} años</strong> - Versión apropiada para menores ✅
            `;
        }

        setTimeout(() => {
          document.getElementById("disclaimer-modal").classList.add("active");
        }, 500);
      }

      function acceptDisclaimer() {
        playSound("success");
        document.getElementById("disclaimer-modal").classList.remove("active");
        document.getElementById("start-screen").classList.add("active");

        // Limpiar cualquier selección previa para empezar fresco
        selectedQuestions = [];
        responses = { partner1: {}, partner2: {} };

        // Actualizar subtítulo según la edad
        const subtitle = document.querySelector(".subtitle");
        if (isAdult) {
          subtitle.textContent =
            "🔞 Descubre qué tan real es tu conexión. 35 preguntas que van directo al grano sin filtros. ¿Están listos para la verdad? 🌶️";
        } else {
          subtitle.textContent =
            "Descubre qué tan fuerte es tu conexión. 35 preguntas honestas sobre tu relación. ¿Están listos para conocerse mejor? 💕";
        }
      }

      function initializeAudio() {
        try {
          audioContext = new (window.AudioContext ||
            window.webkitAudioContext)();
          createSoundEffects();
        } catch (e) {
          console.log("Audio no disponible");
          soundEnabled = false;
        }
      }

      function createSoundEffects() {
        if (!audioContext) return;

        soundEffects.click = createSynth(400, 0.1, "square");
        soundEffects.success = createSynth(600, 0.3, "sawtooth");
        soundEffects.progress = createSynth(800, 0.2, "triangle");
        soundEffects.celebration = createBassline([220, 330, 440, 550], 0.8);
      }

      function createSynth(frequency, duration, waveType = "sine") {
        return () => {
          if (!soundEnabled || !audioContext) return;

          const oscillator = audioContext.createOscillator();
          const gainNode = audioContext.createGain();
          const filter = audioContext.createBiquadFilter();

          oscillator.connect(filter);
          filter.connect(gainNode);
          gainNode.connect(audioContext.destination);

          oscillator.frequency.value = frequency;
          oscillator.type = waveType;
          filter.type = "lowpass";
          filter.frequency.value = frequency * 2;

          gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(
            0.01,
            audioContext.currentTime + duration
          );

          oscillator.start(audioContext.currentTime);
          oscillator.stop(audioContext.currentTime + duration);
        };
      }

      function createBassline(frequencies, duration) {
        return () => {
          if (!soundEnabled || !audioContext) return;

          frequencies.forEach((freq, index) => {
            setTimeout(() => {
              createSynth(freq, duration / frequencies.length, "square")();
            }, (index * (duration * 1000)) / frequencies.length);
          });
        };
      }

      function create3DHearts() {
        const container = document.getElementById("floating-hearts");
        const heartClasses = ["", "cyan", "purple", "orange"];

        for (let i = 0; i < 25; i++) {
          const heart = document.createElement("div");
          heart.className = `heart-3d ${
            heartClasses[Math.floor(Math.random() * heartClasses.length)]
          }`;
          heart.style.left = Math.random() * 100 + "%";
          heart.style.animationDelay = Math.random() * 15 + "s";
          heart.style.animationDuration = Math.random() * 8 + 12 + "s";
          container.appendChild(heart);
        }
      }

      function createNeonParticles() {
        const container = document.getElementById("neon-particles");

        for (let i = 0; i < 30; i++) {
          const particle = document.createElement("div");
          particle.className = "particle";
          particle.style.left = Math.random() * 100 + "%";
          particle.style.top = Math.random() * 100 + "%";
          particle.style.animationDelay = Math.random() * 8 + "s";

          const colors = ["#00ffff", "#ff1493", "#9932cc", "#ff6b35"];
          const color = colors[Math.floor(Math.random() * colors.length)];
          particle.style.background = color;
          particle.style.boxShadow = `0 0 8px ${color}`;

          container.appendChild(particle);
        }
      }

      function selectRandomQuestions() {
        // Usar la función que determina el pool correcto según la edad
        const currentPool = getQuestionPool();

        // Crear grupos de preguntas por categoría
        const categories = {};
        currentPool.forEach((question) => {
          if (!categories[question.category]) {
            categories[question.category] = [];
          }
          categories[question.category].push(question);
        });

        // Limpiar preguntas anteriores
        selectedQuestions = [];

        // Seleccionar 8-9 preguntas de cada categoría aleatoriamente usando timestamp para más randomness
        const timestamp = Date.now();
        const questionsPerCategory = [9, 9, 9, 8]; // Total = 35 preguntas
        let categoryIndex = 0;

        Object.keys(categories).forEach((category) => {
          const categoryQuestions = [...categories[category]]; // Crear copia
          const questionsToSelect = questionsPerCategory[categoryIndex] || 8;

          // Mezclar usando algoritmo Fisher-Yates con timestamp
          for (let i = categoryQuestions.length - 1; i > 0; i--) {
            const randomSeed =
              (timestamp +
                categoryIndex +
                i +
                currentPartner +
                Math.random() * 1000) %
              categoryQuestions.length;
            const j = Math.floor(randomSeed);
            [categoryQuestions[i], categoryQuestions[j]] = [
              categoryQuestions[j],
              categoryQuestions[i],
            ];
          }

          // Tomar las preguntas después del shuffle
          selectedQuestions.push(
            ...categoryQuestions.slice(0, questionsToSelect)
          );
          categoryIndex++;
        });

        // Mezclar el orden final de todas las preguntas con más randomness
        for (let i = selectedQuestions.length - 1; i > 0; i--) {
          const randomSeed =
            (timestamp + currentPartner + Math.random() * 1000 + i) %
            selectedQuestions.length;
          const j = Math.floor(randomSeed);
          [selectedQuestions[i], selectedQuestions[j]] = [
            selectedQuestions[j],
            selectedQuestions[i],
          ];
        }

        const ageText = isAdult ? "🔞 PICANTES" : "👶 APROPIADAS";
        console.log(
          `🔥 ${selectedQuestions.length} preguntas ${ageText} generadas para partner ${currentPartner}`
        );
      }

      function playSound(soundName) {
        if (soundEffects[soundName]) {
          soundEffects[soundName]();
        }
      }

      function playStartSound() {
        playSound("success");
      }

      function toggleSound() {
        soundEnabled = !soundEnabled;
        const toggle = document.getElementById("sound-toggle");
        toggle.textContent = soundEnabled ? "🔊" : "🔇";
        playSound("click");
      }

      function setupEventListeners() {
        document.addEventListener("change", function (e) {
          if (e.target.type === "radio") {
            playSound("click");
            updateProgress();
            checkCompletion();

            const circle = e.target.nextElementSibling;
            circle.style.animation = "none";
            setTimeout(() => {
              circle.style.animation = "checkGlow 0.6s ease";
            }, 10);
          }
        });
      }

      function selectRole(element, role) {
        playSound("click");
        document
          .querySelectorAll(".role-btn")
          .forEach((btn) => btn.classList.remove("selected"));
        element.classList.add("selected");
        currentRole = role;
        document.getElementById("start-test").disabled = false;
      }

      function startTest() {
        playSound("success");
        selectRandomQuestions(); // Generar preguntas aleatorias
        partner1Role = currentRole;
        currentPartner = 1;
        currentQuestionIndex = 0;
        showScreen("test-screen");
        updateTestTitle();
        renderQuestions();
        updateProgress();
      }

      function startPartnerTest() {
        playSound("success");
        partner2Role = currentRole === "novio" ? "novia" : "novio";
        currentRole = partner2Role;
        currentPartner = 2;
        currentQuestionIndex = 0;

        // Generar nuevas preguntas para el segundo partner
        selectRandomQuestions();

        showScreen("test-screen");
        updateTestTitle();
        renderQuestions();
        updateProgress();
      }

      function updateTestTitle() {
        const title = document.getElementById("test-title");
        const roleText = currentRole === "novio" ? "ÉL 👨" : "ELLA 👩";
        title.textContent = `TEST - ${roleText} (PARTE ${currentPartner}/2)`;
      }

      function renderQuestions() {
        const container = document.getElementById("questions-container");
        container.innerHTML = "";

        selectedQuestions.forEach((question, index) => {
          const questionDiv = document.createElement("div");
          questionDiv.className = "question";
          questionDiv.style.animationDelay = `${index * 0.1}s`;

          questionDiv.innerHTML = `
                <h3>${index + 1}. ${question.text}</h3>
                <div class="likert-scale">
                    ${[1, 2, 3, 4, 5]
                      .map(
                        (value) => `
                        <label class="likert-option">
                            <input type="radio" name="q${index}" value="${value}">
                            <div class="likert-circle">${value}</div>
                            <div class="likert-label">${getLikertLabel(
                              value
                            )}</div>
                        </label>
                    `
                      )
                      .join("")}
                </div>
            `;

          container.appendChild(questionDiv);
        });
      }

      function getLikertLabel(value) {
        const labels = {
          1: "Para nada",
          2: "Poco",
          3: "Normal",
          4: "Bastante",
          5: "Totalmente",
        };
        return labels[value];
      }

      function updateProgress() {
        const answeredQuestions = document.querySelectorAll(
          'input[type="radio"]:checked'
        ).length;
        const progress = (answeredQuestions / selectedQuestions.length) * 100;
        document.getElementById("progress-fill").style.width = `${progress}%`;

        if (answeredQuestions > 0 && answeredQuestions % 5 === 0) {
          playSound("progress");
        }
      }

      function checkCompletion() {
        const answeredQuestions = document.querySelectorAll(
          'input[type="radio"]:checked'
        ).length;
        const continueBtn = document.getElementById("continue-test");
        const wasDisabled = continueBtn.disabled;
        continueBtn.disabled = answeredQuestions < selectedQuestions.length;

        if (wasDisabled && !continueBtn.disabled) {
          playSound("success");
        }
      }

      function handleContinue() {
        playSound("success");
        saveResponses();

        if (currentPartner === 1) {
          showScreen("transition-screen");
        } else {
          showScreen("loading-screen");
          setTimeout(() => {
            calculateAndShowResults();
          }, 3000);
        }
      }

      function saveResponses() {
        const partnerKey = `partner${currentPartner}`;
        responses[partnerKey] = {};

        selectedQuestions.forEach((question, index) => {
          const selectedInput = document.querySelector(
            `input[name="q${index}"]:checked`
          );
          if (selectedInput) {
            let value = parseInt(selectedInput.value);
            if (question.reverse) {
              value = 6 - value;
            }
            responses[partnerKey][index] = {
              value: value,
              category: question.category,
              originalQuestion: question.text,
            };
          }
        });
      }

      function calculateAndShowResults() {
        const results = {
          partner1: calculateDetailedScore(responses.partner1),
          partner2: calculateDetailedScore(responses.partner2),
        };

        const coupleResult = calculateCoupleResult(
          results.partner1.score,
          results.partner2.score
        );
        showProfessionalResults(results, coupleResult);
        playSound("celebration");
      }

      function calculateDetailedScore(partnerResponses) {
        let totalScore = 0;
        let count = 0;
        let categoryScores = {};

        // Inicializar categorías según la edad
        const categories = isAdult
          ? [
              "Conexión Emocional",
              "Deseo y Atracción",
              "Comunicación y Honestidad",
              "Tentación y Deseo Externo",
            ]
          : [
              "Conexión Emocional",
              "Atracción y Romance",
              "Comunicación",
              "Compromiso y Futuro",
            ];

        categories.forEach((cat) => {
          categoryScores[cat] = { total: 0, count: 0 };
        });

        // Calcular puntajes por categoría
        for (let questionIndex in partnerResponses) {
          const response = partnerResponses[questionIndex];
          totalScore += response.value;
          count++;

          // Acumular por categoría
          if (categoryScores[response.category]) {
            categoryScores[response.category].total += response.value;
            categoryScores[response.category].count++;
          }
        }

        // Calcular promedios
        const averageScore = totalScore / count;
        const normalizedScore = Math.round(((averageScore - 1) / 4) * 100);

        // Calcular puntajes por categoría
        const categoryResults = {};
        Object.keys(categoryScores).forEach((category) => {
          if (categoryScores[category].count > 0) {
            const catAvg =
              categoryScores[category].total / categoryScores[category].count;
            categoryResults[category] = Math.round(((catAvg - 1) / 4) * 100);
          }
        });

        return {
          score: normalizedScore,
          level: getRiskLevel(normalizedScore),
          analysis: getAnalysisText(normalizedScore),
          categoryScores: categoryResults,
          totalQuestions: count,
          averageResponse: averageScore.toFixed(2),
        };
      }

      function getRiskLevel(score) {
        if (score <= 35) return { text: "BAJO RIESGO 💚", class: "risk-low" };
        if (score <= 70)
          return { text: "RIESGO MEDIO 🟡", class: "risk-medium" };
        return { text: "RIESGO ALTO 🔴", class: "risk-high" };
      }

      function getAnalysisText(score) {
        if (score <= 35) {
          return "¡DAMN BRO! 🔥 Tu mente está súper limpia y conectada. Tus pensamientos están 100% con tu pareja. Esto es lo que llamo fidelidad mental real, no hay nada que te 'distraiga' 💯🧠";
        } else if (score <= 70) {
          return "Ey, tu mente está 'jugando' un poco por ahí 😏 Hay algunas fantasías y pensamientos que están 'calentando' otras áreas. Nada grave, pero hay que estar consciente de dónde va la mente 🧠🌶️";
        } else {
          return "Bro... tu mente está 'corriendo' hacia otros lados 🏃‍♀️🔥 Hay muchas fantasías y deseos que están 'explorando' territorios prohibidos. Es momento de decidir qué quieres realmente 🤔💭";
        }
      }

      function calculateCoupleResult(score1, score2) {
        const betrayalIndex = Math.round((score1 + score2) / 2);

        let classification, icon, message;

        if (score1 <= 35 && score2 <= 35) {
          classification = "🔥 PAREJA MENTALMENTE FIEL";
          icon = "🔥";
          message =
            "¡YO! 💯 Sus mentes están súper conectadas y limpias. No hay fantasías raras ni pensamientos 'sucios' hacia otros. Esto es fidelidad mental REAL, bro 🧠💘";
        } else if (score1 > 70 && score2 > 70) {
          classification = "🚨 MENTES EN PELIGRO";
          icon = "🚨";
          message =
            "Real talk... 😰 Ambos tienen la mente 'corriendo' hacia otros lados. Hay muchas fantasías y deseos 'calientes' que no incluyen a su pareja. Esto está peligroso 🌶️💭";
        } else {
          classification = "⚠️ UNO ESTÁ 'CALIENTE' POR OTROS";
          icon = "⚠️";
          message =
            "Ojo aquí... 🤨 Uno de ustedes tiene la mente más 'sucia' que el otro. Hay fantasías y deseos que están 'explorando' territorios prohibidos. Hay que hablar esto 🗣️🔥";
        }

        return { classification, icon, message, betrayalIndex };
      }

      function showProfessionalResults(results, coupleResult) {
        const modal = document.getElementById("results-modal");
        const content = document.getElementById("results-content");

        const partner1RoleText = partner1Role === "novio" ? "ÉL 👨" : "ELLA 👩";
        const partner2RoleText = partner2Role === "novio" ? "ÉL 👨" : "ELLA 👩";

        content.innerHTML = `
            <div class="result-header">
                <div class="result-icon">${coupleResult.icon}</div>
                <h2>ANÁLISIS COMPLETO DE RESULTADOS</h2>
            </div>

            <!-- Comparación Visual -->
            <div class="comparison-chart">
                <div class="chart-title">Comparación de Scores</div>
                <div class="chart-bars">
                    <div>
                        <div class="chart-bar" data-value="${
                          results.partner1.score
                        }" style="height: ${
          results.partner1.score * 1.5
        }px;"></div>
                        <div class="chart-label">${partner1RoleText}</div>
                    </div>
                    <div>
                        <div class="chart-bar" data-value="${
                          results.partner2.score
                        }" style="height: ${
          results.partner2.score * 1.5
        }px;"></div>
                        <div class="chart-label">${partner2RoleText}</div>
                    </div>
                </div>
            </div>

            <!-- Estadísticas Generales -->
            <div class="stats-container">
                <div class="chart-title">Estadísticas del Test</div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value">${
                          selectedQuestions.length
                        }</div>
                        <div class="stat-label">${
                          isAdult
                            ? "Preguntas Picantes"
                            : "Preguntas Apropiadas"
                        }</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${Math.round(
                          (results.partner1.score + results.partner2.score) / 2
                        )}%</div>
                        <div class="stat-label">Promedio</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${Math.abs(
                          results.partner1.score - results.partner2.score
                        )}</div>
                        <div class="stat-label">Diferencia</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">${
                          coupleResult.betrayalIndex
                        }%</div>
                        <div class="stat-label">${
                          isAdult ? "Índice Mental" : "Índice Emocional"
                        }</div>
                    </div>
                </div>
            </div>

            <div class="scores-grid">
                <div class="score-display">
                    <h3>${partner1RoleText}</h3>
                    <div class="score-number">${results.partner1.score}</div>
                    <div class="score-label">DE 100 PUNTOS</div>
                    <div class="risk-level ${results.partner1.level.class}">${
          results.partner1.level.text
        }</div>
                    
                    <!-- Análisis por categorías -->
                    <div class="category-breakdown">
                        <h4 style="color: #00ffff; margin-bottom: 15px; font-family: 'Orbitron', monospace;">ANÁLISIS POR CATEGORÍAS</h4>
                        ${Object.keys(results.partner1.categoryScores)
                          .map(
                            (category) => `
                            <div class="category-item">
                                <div class="category-header">
                                    <span class="category-name">${category}</span>
                                    <span class="category-score">${results.partner1.categoryScores[category]}%</span>
                                </div>
                                <div class="category-bar">
                                    <div class="category-fill" style="width: ${results.partner1.categoryScores[category]}%"></div>
                                </div>
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                    
                    <p class="analysis-text">${results.partner1.analysis}</p>
                </div>
                
                <div class="score-display">
                    <h3>${partner2RoleText}</h3>
                    <div class="score-number">${results.partner2.score}</div>
                    <div class="score-label">DE 100 PUNTOS</div>
                    <div class="risk-level ${results.partner2.level.class}">${
          results.partner2.level.text
        }</div>
                    
                    <!-- Análisis por categorías -->
                    <div class="category-breakdown">
                        <h4 style="color: #00ffff; margin-bottom: 15px; font-family: 'Orbitron', monospace;">ANÁLISIS POR CATEGORÍAS</h4>
                        ${Object.keys(results.partner2.categoryScores)
                          .map(
                            (category) => `
                            <div class="category-item">
                                <div class="category-header">
                                    <span class="category-name">${category}</span>
                                    <span class="category-score">${results.partner2.categoryScores[category]}%</span>
                                </div>
                                <div class="category-bar">
                                    <div class="category-fill" style="width: ${results.partner2.categoryScores[category]}%"></div>
                                </div>
                            </div>
                        `
                          )
                          .join("")}
                    </div>
                    
                    <p class="analysis-text">${results.partner2.analysis}</p>
                </div>
            </div>

            <div class="couple-result">
                <h3>💘 RESULTADO DE PAREJA</h3>
                <div class="couple-classification">${
                  coupleResult.classification
                }</div>
                <div style="font-size: 1.1rem; font-weight: 600; margin: 12px 0; color: #ffffff; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);">${
                  isAdult
                    ? "ÍNDICE DE INFIDELIDAD MENTAL"
                    : "ÍNDICE DE DESCONEXIÓN EMOCIONAL"
                }</div>
                <div class="betrayal-index">${coupleResult.betrayalIndex}%</div>
                <p class="analysis-text">${coupleResult.message}</p>
                
                <!-- Recomendaciones -->
                <div style="margin-top: 20px; padding: 15px; background: rgba(0, 0, 0, 0.6); border-radius: 12px; border-left: 4px solid #ff1493;">
                    <h4 style="color: #ff1493; margin-bottom: 10px;">🎯 RECOMENDACIONES</h4>
                    <p style="color: #ffffff; font-size: 0.9rem; line-height: 1.4;">
                        ${getRecommendations(
                          results.partner1.score,
                          results.partner2.score
                        )}
                    </p>
                </div>
            </div>
        `;

        modal.classList.add("active");
      }

      function getRecommendations(score1, score2) {
        if (score1 <= 35 && score2 <= 35) {
          return "¡Sus mentes están súper limpias! 🧠✨ Sigan así, no se dejen 'calentar' por otros. Su fidelidad mental es REAL. ¡A seguir siendo fieles en pensamientos y acciones! 💪🔥";
        } else if (score1 > 70 || score2 > 70) {
          return "Ojo... hay mentes 'calientes' aquí 🌶️🧠 Es momento de hablar sobre esas fantasías y deseos. Decidan si quieren 'enfriar' esos pensamientos o ser honestos sobre lo que sienten 💭🔥";
        } else {
          return "Hay pensamientos que están 'jugando' por ahí 😏 Nada grave pero hay que estar conscientes. Hablen sobre sus fantasías y mantengan la mente enfocada en lo que realmente quieren 🎯💕";
        }
      }

      function closeModal() {
        playSound("click");
        document.getElementById("results-modal").classList.remove("active");
      }

      function restartTest() {
        playSound("success");

        // Resetear todas las variables
        currentRole = "";
        currentQuestionIndex = 0;
        currentPartner = 1;
        responses = { partner1: {}, partner2: {} };
        partner1Role = "";
        partner2Role = "";
        selectedQuestions = []; // Limpiar preguntas para que se generen nuevas
        userAge = null;
        isAdult = false;

        document
          .querySelectorAll(".role-btn")
          .forEach((btn) => btn.classList.remove("selected"));
        document.getElementById("start-test").disabled = true;
        document.getElementById("age-input").value = "";
        document.getElementById("age-continue-btn").disabled = true;

        closeModal();
        // Volver al modal de edad
        document.getElementById("age-modal").classList.add("active");
      }

      function shareResult() {
        playSound("click");

        const shareText = `¡Acabo de hacer el Test de Fuerza Relacional! 💘🔥
        
Los resultados están locos... ¿Te atreves a hacerlo con tu pareja? 

#TestDePareja #RelationshipGoals #RealTalk`;

        if (navigator.share) {
          navigator.share({
            title: "💘 Test de Fuerza Relacional",
            text: shareText,
            url: window.location.href,
          });
        } else {
          navigator.clipboard
            .writeText(shareText + "\n\n" + window.location.href)
            .then(() => {
              alert("¡Texto copiado! Ahora pégalo donde quieras 📋💥");
            })
            .catch(() => {
              alert("¡Función de compartir lista! 📱💥");
            });
        }
      }

      function showScreen(screenId) {
        document.querySelectorAll(".screen").forEach((screen) => {
          screen.classList.remove("active");
        });

        setTimeout(() => {
          document.getElementById(screenId).classList.add("active");
        }, 100);
      }
    </script>
        <script src="security.js"></script>
  </body>
</html>

  

